{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "background": "white",
  "data": {
    "url": "https://raw.githubusercontent.com/Krisha15502/Krisha15502.github.io/refs/heads/main/data/heatwave.csv"
  },
  "params": [
    {
      "name": "year_slider",
      "value": 2010,
      "bind": {
        "input": "range",
        "min": 1967,
        "max": 2024,
        "step": 1,
        "name": "Select Year: "
      }
    },
    {
      "name": "state_selected",
      "value": null,
      "on": [
        {"events": "rect:click", "update": "datum.state"},
        {"events": "view:dblclick", "update": "null"}
      ]
    }
  ],
  "vconcat": [
    {
      "title": {
        "text": "Extreme Heat Days in India (1967–2024)",
        "subtitle": "Slide to choose a year and click on a State to track trends",
        "font": "Times New Roman",
        "subtitleFont": "Times New Roman",
        "fontSize": 20,
        "subtitleFontSize": 13,
        "fontWeight": 600,
        "anchor": "middle",
        "color": "#2c3e50"
      },
      "width": 900,
      "height": 500,
      "transform": [{"filter": "datum.year == year_slider"}],
      "mark": {"type": "bar", "cornerRadiusEnd": 3, "cursor": "pointer"},
      "encoding": {
        "y": {
          "field": "state",
          "type": "nominal",
          "axis": {"title": null, "labelFontSize": 12, "labelLimit": 200}
        },
        "x": {
          "field": "avg_days",
          "type": "quantitative",
          "axis": {
            "title": "Average Heatwave Days per Year",
            "grid": true,
            "gridOpacity": 0.8
          },
          "scale": {"domain": [0, 33]}
        },
        "color": {
          "field": "avg_days",
          "type": "quantitative",
          "scale": {
            "type": "linear",
            "domain": [0, 5, 10, 15, 20, 25, 30],
            "range": [
              "#1F4D0C",
              "#5FA27A",
              "#88B584",
              "#D8CFC4",
              "#9B2C2C",
              "#6B0F1A",
              "#3D0308"
            ]
          },
          "legend": {
            "title": "Heatwave Days",
            "orient": "bottom",
            "direction": "horizontal"
          }
        },
        "opacity": {
          "condition": {
            "test": "state_selected === null || datum.state === state_selected",
            "value": 1
          },
          "value": 0.35
        },
        "stroke": {
          "condition": {
            "test": "datum.state === state_selected",
            "value": "#333333"
          },
          "value": null
        },
        "strokeWidth": {
          "condition": {"test": "datum.state === state_selected", "value": 2},
          "value": 0
        },
        "tooltip": [
          {"field": "state", "type": "nominal", "title": "State"},
          {
            "field": "year",
            "type": "quantitative",
            "title": "Year",
            "format": "d"
          },
          {
            "field": "avg_days",
            "type": "quantitative",
            "title": "Heatwave Days"
          }
        ]
      }
    },
    {
      "title": {
        "text": "Heatwave Trends Over Time",
        "subtitle": {
          "signal": "state_selected === null ? 'All-India Average (1967–2024)' : state_selected + ' (1967–2024)'"
        },
        "font": "Times New Roman",
        "subtitleFont": "Times New Roman",
        "fontSize": 20,
        "subtitleFontSize": 13,
        "anchor": "middle",
        "color": "#2c3e50"
      },
      "width": 900,
      "height": 270,
      "layer": [
        {
          "transform": [
            {"filter": "state_selected === null"},
            {
              "aggregate": [
                {"op": "mean", "field": "avg_days", "as": "avg_days_mean"}
              ],
              "groupby": ["year"]
            }
          ],
          "mark": {"type": "line", "point": {"filled": true, "size": 60}},
          "encoding": {
            "x": {
              "field": "year",
              "type": "quantitative",
              "axis": {"title": "Year", "tickCount": 15, "format": "d"}
            },
            "y": {
              "field": "avg_days_mean",
              "type": "quantitative",
              "axis": {"title": "Heatwave Days"}
            },
            "color": {"value": "#636363"}
          }
        },
        {
          "transform": [
            {
              "filter": "state_selected != null && datum.state === state_selected"
            }
          ],
          "mark": {"type": "line", "point": {"filled": true, "size": 60}},
          "encoding": {
            "x": {
              "field": "year",
              "type": "quantitative",
              "axis": {"format": "d"}
            },
            "y": {"field": "avg_days", "type": "quantitative"},
            "color": {"value": "#636363"}
          }
        },
        {
          "transform": [
            {"filter": "datum.year == year_slider"},
            {
              "aggregate": [
                {"op": "mean", "field": "avg_days", "as": "avg_days_mean"}
              ],
              "groupby": ["year"]
            }
          ],
          "mark": {"type": "rule", "strokeDash": [2, 2], "strokeWidth": 3},
          "encoding": {
            "x": {
              "field": "year",
              "type": "quantitative",
              "axis": {"format": "d"}
            },
            "color": {"value": "red"}
          }
        }
      ]
    }
  ],
  "config": {
    "view": {"strokeWidth": 0},
    "axis": {
      "labelFontSize": 11,
      "titleFontSize": 13,
      "labelColor": "#555",
      "titleColor": "#333",
      "labelFont": "Times New Roman",
      "titleFont": "Times New Roman"
    },
    "legend": {"labelFont": "Times New Roman", "titleFont": "Times New Roman"}
  }
}